<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Truncar Silencio PRO</title>

<meta name="google-adsense-account" content="ca-pub-8057748170377702">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8057748170377702" crossorigin="anonymous"></script>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.1/lame.all.min.js"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
*{font-family:'Inter',sans-serif}
body{background:linear-gradient(135deg,#0f172a,#1e1b4b);color:white;-webkit-tap-highlight-color:transparent}
.card-pro{background:linear-gradient(145deg,rgba(30,41,59,.95),rgba(15,23,42,.95));border:2px solid rgba(168,85,247,.4);backdrop-filter:blur(20px)}
.btn-primary{background:linear-gradient(135deg,#a855f7,#8b5cf6)}
.btn-success{background:linear-gradient(135deg,#10b981,#059669)}
audio{width:100%;height:45px;border-radius:12px}
</style>
</head>

<body>
<div id="root"></div>

<script>
(function(){
const e=React.createElement;
const{useState,useRef}=React;

function App(){
const[file,setFile]=useState(null);
const[isProc,setIsProc]=useState(false);
const[prog,setProg]=useState(0);
const[url,setUrl]=useState(null);
const[fileName,setFileName]=useState('');
const audioCtx=useRef(null);

async function processAudio(){
if(!file)return;
setIsProc(true);setProg(10);
try{
if(!audioCtx.current)audioCtx.current=new(window.AudioContext||window.webkitAudioContext)();
const buf=await audioCtx.current.decodeAudioData(await file.arrayBuffer());
const data=buf.getChannelData(0);
const rate=buf.sampleRate;
const limit=Math.pow(10,-30/20);
const minSilence=Math.floor(.6*rate);

let out=new Float32Array(data.length),o=0;
for(let i=0;i<data.length;){
if(Math.abs(data[i])<limit){
let s=i;while(i<data.length&&Math.abs(data[i])<limit)i++;
if(i-s>=minSilence){for(let j=0;j<Math.floor(.1*rate);j++)out[o++]=0}
else for(let j=s;j<i;j++)out[o++]=data[j];
}else out[o++]=data[i++];
}
setProg(50);

const enc=new lamejs.Mp3Encoder(1,rate,128),chunks=[];
for(let i=0;i<o;i+=1152){
const c=out.subarray(i,Math.min(i+1152,o));
const i16=new Int16Array(c.length);
for(let j=0;j<c.length;j++){const v=Math.max(-1,Math.min(1,c[j]));i16[j]=v<0?v*0x8000:v*0x7fff}
const b=enc.encodeBuffer(i16);if(b.length)chunks.push(new Uint8Array(b));
}
const f=enc.flush();if(f.length)chunks.push(new Uint8Array(f));
const blob=new Blob(chunks,{type:'audio/mpeg'});
const blobUrl=URL.createObjectURL(blob);
setUrl(blobUrl);
setFileName(file.name.replace(/\.[^/.]+$/,"")+"_optimizado.mp3");
setProg(100);setIsProc(false);
}catch(err){alert("Error: "+err.message);setIsProc(false);setProg(0);}
}

return e("div",{className:"min-h-screen flex flex-col items-center justify-center p-6"},
e("div",{className:"w-full max-w-md card-pro p-8 rounded-3xl"},
e("h1",{className:"text-center text-3xl font-black mb-4"},"TRUNCAR SILENCIO PRO"),

e("input",{type:"file",accept:"audio/*",className:"mb-6",onChange:e=>setFile(e.target.files[0])}),

!url
?e("button",{onClick:processAudio,disabled:!file||isProc,className:"btn-primary w-full py-4 rounded-xl font-black"},
isProc?"Procesando…":"PROCESAR AUDIO")

:e("div",{className:"space-y-4"},
e("audio",{controls:true,src:url}),
e("a",{href:url,download:fileName,className:"btn-success block w-full text-center py-4 rounded-xl font-black text-lg"},
"⬇️ DESCARGAR AUDIO"),
e("button",{onClick:()=>{URL.revokeObjectURL(url);setUrl(null);setFile(null)},className:"w-full text-xs text-purple-300 mt-4"},
"Procesar otro audio")
)
)
);
}

ReactDOM.createRoot(document.getElementById("root")).render(e(App));
})();
</script>
</body>
</html>

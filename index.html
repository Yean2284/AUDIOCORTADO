<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Audio Acortador</title>
    <meta name="google-adsense-account" content="ca-pub-8057748170377702">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8057748170377702" crossorigin="anonymous"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.1/lame.all.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        
        * { font-family: 'Inter', sans-serif; }
        
        body { 
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            color: white;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }
        
        .card-pro { 
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.95));
            border: 2px solid rgba(168, 85, 247, 0.4);
            backdrop-filter: blur(20px);
            box-shadow: 0 25px 50px -12px rgba(139, 92, 246, 0.25);
            transition: all 0.3s ease;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(168, 85, 247, 0.4); }
            50% { box-shadow: 0 0 40px rgba(168, 85, 247, 0.6); }
        }
        
        .file-drop-zone {
            transition: all 0.3s ease;
            border: 2px dashed rgba(168, 85, 247, 0.3);
            border-radius: 1.5rem;
            padding: 2.5rem;
            background: rgba(15, 23, 42, 0.3);
        }
        
        .file-drop-zone:hover {
            border-color: rgba(168, 85, 247, 0.6);
            transform: scale(1.02);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #a855f7 0%, #8b5cf6 100%);
            transition: all 0.3s ease;
            padding: 1.25rem;
            border-radius: 1rem;
            font-weight: 900;
            font-size: 1.125rem;
            box-shadow: 0 10px 40px rgba(139, 92, 246, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 50px rgba(168, 85, 247, 0.5);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transition: all 0.3s ease;
            padding: 1.25rem;
            border-radius: 1rem;
            font-weight: 900;
            font-size: 1.125rem;
            box-shadow: 0 10px 40px rgba(16, 185, 129, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 50px rgba(16, 185, 129, 0.5);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #a855f7 0%, #ec4899 50%, #8b5cf6 100%);
            background-size: 200% 100%;
            animation: gradient-shift 2s ease infinite;
            height: 0.75rem;
            border-radius: 9999px;
        }
        
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .icon-bounce {
            animation: bounce 1s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        audio {
            width: 100%;
            height: 45px;
            border-radius: 12px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        function App() {
            const [file, setFile] = useState(null);
            const [isProc, setIsProc] = useState(false);
            const [prog, setProg] = useState(0);
            const [url, setUrl] = useState(null);
            const [fileName, setFileName] = useState('');
            const [audioBlob, setAudioBlob] = useState(null);
            const [canShare, setCanShare] = useState(false);
            const audioCtx = useRef(null);
            const audioRef = useRef(null);

            React.useEffect(() => {
                if (navigator.share && navigator.canShare) {
                    setCanShare(true);
                }
            }, []);

            const generateUniqueFileName = (originalName) => {
                let baseName = originalName.replace(/\.[^/.]+$/, "");
                baseName = baseName.replace(/_optimizado(_\d+)?(_\d{8}_\d+)?$/g, "");
                baseName = baseName.replace(/[<>:"/\\|?*]/g, '_');
                const timestamp = Date.now();
                const dateStr = new Date().toISOString().slice(0,10).replace(/-/g, '');
                return `${baseName}_optimizado_${dateStr}_${timestamp}.mp3`;
            };

            const shareAudio = async () => {
                if (!audioBlob || !fileName) return;
                
                try {
                    const fileToShare = new File([audioBlob], fileName, { type: 'audio/mpeg' });
                    
                    if (navigator.canShare && navigator.canShare({ files: [fileToShare] })) {
                        await navigator.share({
                            files: [fileToShare],
                            title: 'Audio Optimizado',
                            text: 'Audio procesado con Audio Acortador'
                        });
                    } else {
                        alert('Tu dispositivo no soporta la funci√≥n de compartir archivos. Por favor, mant√©n presionado el reproductor de audio y selecciona "Descargar".');
                    }
                } catch (error) {
                    if (error.name !== 'AbortError') {
                        console.error('Error al compartir:', error);
                        alert('No se pudo compartir el archivo. Por favor, mant√©n presionado el reproductor de audio y selecciona "Descargar".');
                    }
                }
            };

            const processAudio = async () => {
                if (!file) return;
                setIsProc(true);
                setProg(10);
                
                try {
                    if (url) {
                        URL.revokeObjectURL(url);
                        setUrl(null);
                    }
                    
                    if (audioRef.current) {
                        audioRef.current.pause();
                        audioRef.current.src = '';
                    }
                    
                    if (!audioCtx.current) {
                        audioCtx.current = new (window.AudioContext || window.webkitAudioContext)();
                    }
                    
                    const buf = await audioCtx.current.decodeAudioData(await file.arrayBuffer());
                    const data = buf.getChannelData(0);
                    const rate = buf.sampleRate;
                    const limit = Math.pow(10, -30 / 20);
                    const minSilence = Math.floor(0.6 * rate);
                    
                    let output = new Float32Array(data.length);
                    let outIdx = 0;
                    
                    for (let i = 0; i < data.length; ) {
                        if (Math.abs(data[i]) < limit) {
                            let s = i;
                            while (i < data.length && Math.abs(data[i]) < limit) i++;
                            if ((i - s) >= minSilence) {
                                const m = Math.floor(0.1 * rate);
                                for (let j = 0; j < m; j++) output[outIdx++] = 0;
                            } else {
                                for (let j = s; j < i; j++) output[outIdx++] = data[j];
                            }
                        } else {
                            output[outIdx++] = data[i]; i++;
                        }
                        if (i % 1000000 === 0) await new Promise(r => setTimeout(r, 0));
                    }
                    
                    setProg(50);
                    
                    const enc = new lamejs.Mp3Encoder(1, rate, 128);
                    const chunks = [];
                    for (let i = 0; i < outIdx; i += 1152) {
                        const chunk = output.subarray(i, i + 1152);
                        const i16 = new Int16Array(chunk.length);
                        for (let j = 0; j < chunk.length; j++) {
                            const v = Math.max(-1, Math.min(1, chunk[j]));
                            i16[j] = v < 0 ? v * 0x8000 : v * 0x7FFF;
                        }
                        const b = enc.encodeBuffer(i16);
                        if (b.length > 0) chunks.push(new Uint8Array(b));
                        if (i % 400000 === 0) {
                            setProg(Math.floor(50 + (i / outIdx) * 45));
                            await new Promise(r => setTimeout(r, 0)); 
                        }
                    }
                    chunks.push(new Uint8Array(enc.flush()));
                    
                    const blob = new Blob(chunks, { type: 'audio/mpeg' });
                    const blobUrl = URL.createObjectURL(blob);
                    const uniqueFileName = generateUniqueFileName(file.name);
                    
                    setAudioBlob(blob);
                    setUrl(blobUrl);
                    setFileName(uniqueFileName);
                    setProg(100);
                    
                    await new Promise(r => setTimeout(r, 100));
                    setIsProc(false);
                    
                } catch (e) { 
                    console.error("Error procesando audio:", e);
                    alert("Error al procesar el audio: " + e.message); 
                    setIsProc(false);
                    setProg(0);
                }
            };

            const handleReset = () => {
                if (url) {
                    URL.revokeObjectURL(url);
                }
                if (audioRef.current) {
                    audioRef.current.pause();
                    audioRef.current.src = '';
                }
                
                setUrl(null); 
                setFile(null); 
                setProg(0); 
                setFileName('');
                setAudioBlob(null);
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6">
                    
                    <div className="w-full max-w-md card-pro p-10 rounded-[3rem] shadow-2xl floating">
                        <div className="flex justify-center mb-6">
                            <div className="w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center text-4xl shadow-lg pulse-glow">
                                üéµ
                            </div>
                        </div>
                        
                        <h1 className="text-center text-3xl font-black mb-3 gradient-text tracking-tight">
                            AUDIO ACORTADOR
                        </h1>
                        
                        <p className="text-center text-xs text-purple-300/70 mb-8 font-semibold">
                            Archivo seleccionado:
                        </p>
                        
                        <div className="file-drop-zone text-center mb-8">
                            <input type="file" onChange={e => setFile(e.target.files[0])} className="hidden" id="aud" accept="audio/*" />
                            <label htmlFor="aud" className="cursor-pointer block">
                                <span className={`text-5xl block mb-4 ${!file && 'icon-bounce'}`}>
                                    {file ? "‚úÖ" : "üìÅ"}
                                </span>
                                <span className="text-sm text-purple-200 font-bold tracking-wide block mb-2">
                                    {file ? file.name : "Toca para seleccionar audio"}
                                </span>
                            </label>
                        </div>

                        {isProc && (
                            <div className="mb-8">
                                <div className="flex justify-between text-xs text-purple-300 mb-2 font-semibold">
                                    <span>Procesando...</span>
                                    <span>{prog}%</span>
                                </div>
                                <div className="w-full bg-slate-900/50 rounded-full overflow-hidden">
                                    <div className="progress-bar" style={{ width: `${prog}%`, transition: 'width 0.3s' }}></div>
                                </div>
                            </div>
                        )}

                        {!url ? (
                            <button 
                                onClick={processAudio} 
                                disabled={!file || isProc} 
                                className="btn-primary w-full disabled:opacity-40 disabled:cursor-not-allowed"
                            >
                                {isProc ? "‚ö° CONVIRTIENDO..." : "üöÄ PROCESAR AUDIO"}
                            </button>
                        ) : (
                            <div className="space-y-4">
                                <div className="bg-purple-900/20 border border-purple-500/20 rounded-2xl p-5">
                                    <p className="text-xs text-purple-300 mb-3 text-center font-bold">
                                        ‚úÖ Audio procesado exitosamente
                                    </p>
                                    <audio 
                                        ref={audioRef}
                                        controls 
                                        className="w-full mb-3" 
                                        src={url}
                                        preload="metadata"
                                    >
                                        Tu navegador no soporta audio HTML5.
                                    </audio>
                                    <p className="text-[10px] text-purple-300/60 text-center break-all px-2">
                                        üìÑ {fileName}
                                    </p>
                                </div>
                                
                                {canShare && (
                                    <button 
                                        onClick={shareAudio}
                                        className="btn-success w-full"
                                    >
                                        üì§ GUARDAR AUDIO
                                    </button>
                                )}
                                
                                <div className="bg-green-900/20 border-2 border-green-500/30 rounded-2xl p-5">
                                    <p className="text-xs font-bold text-green-300 mb-3 text-center">
                                        INSTRUCCIONES DE DESCARGA
                                    </p>
                                    <p className="text-xs text-green-200/90 leading-relaxed">
                                        Para descargar el audio optimizado, mant√©n presionado el reproductor de audio y selecciona la opci√≥n "Descargar" o "Guardar audio" del men√∫ que aparecer√°. El archivo se guardar√° en tu carpeta de Descargas con un nombre √∫nico.
                                    </p>
                                </div>
                                
                                <button 
                                    onClick={handleReset} 
                                    className="w-full text-xs text-purple-400 hover:text-purple-300 uppercase font-bold text-center py-3 rounded-xl bg-slate-900/30 hover:bg-slate-900/50 transition-all"
                                >
                                    üîÑ Procesar otro audio
                                </button>
                            </div>
                        )}
                    </div>
                    
                    <div className="mt-8 text-center opacity-50">
                        <p className="text-[10px] uppercase font-bold tracking-widest text-purple-300/50">
                            ¬© 2025 YEAN CARLOS GODOY GONZ√ÅLEZ
                        </p>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
